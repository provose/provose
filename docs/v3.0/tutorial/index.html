<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-156547622-4"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-156547622-4'); </script> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Tutorial | Provose</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Tutorial" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Provose is the easiest way to manage your Amazon Web Services infrastructure." /> <meta property="og:description" content="Provose is the easiest way to manage your Amazon Web Services infrastructure." /> <link rel="canonical" href="/v3.0/tutorial/" /> <meta property="og:url" content="/v3.0/tutorial/" /> <meta property="og:site_name" content="Provose" /> <meta property="og:image" content="/assets/images/1x/twitter-facebook-preview-card-1x.png" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="/assets/images/1x/twitter-facebook-preview-card-1x.png" /> <meta property="twitter:title" content="Tutorial" /> <meta name="twitter:site" content="@neocrym" /> <script type="application/ld+json"> {"description":"Provose is the easiest way to manage your Amazon Web Services infrastructure.","@type":"WebPage","headline":"Tutorial","url":"/v3.0/tutorial/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/1x/logo-black-on-transparent-1x.png"}},"image":"/assets/images/1x/twitter-facebook-preview-card-1x.png","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> <link rel="manifest" href="/site.webmanifest"> <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#2869e6"> <meta name="msapplication-TileColor" content="#2869e6"> <meta name="theme-color" content="#ffffff"> <!-- From https://www.osano.com/cookieconsent/download/ --> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" /> <!-- From https://www.osano.com/cookieconsent/download/ --> <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script> <script> window.cookieconsent.initialise({ "palette": { "popup": { "background": "#252e39" }, "button": { "background": "#14a7d0" } }, "theme": "edgeless", "content": { "message": "Provose uses cookies in order for us to better understand users and catch our own mistakes.", "href": "https://provose.com/privacy/" } }); </script> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="/contributing/" class="nav-list-link">Contributing to Provose</a></li><li class="nav-list-item"><a href="/changelog/" class="nav-list-link">Changelog</a></li><li class="nav-list-item"><a href="/philosophy/" class="nav-list-link">Philosophy</a></li><li class="nav-list-item"><a href="/security/" class="nav-list-link">Security</a></li><li class="nav-list-item"><a href="/naming/" class="nav-list-link">DNS and naming conventions</a></li><li class="nav-list-item"><a href="/amazon-machine-images-amis/" class="nav-list-link">Amazon Machine Images (AMIs)</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/v3.0/" class="nav-list-link">Docs v3.0 (Stable)</a><ul class="nav-list "><li class="nav-list-item "><a href="/v3.0/release-notes/" class="nav-list-link">Release notes</a></li><li class="nav-list-item active"><a href="/v3.0/tutorial/" class="nav-list-link active">Tutorial</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/v3.0/reference/" class="nav-list-link">Reference v3.0 (Stable)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/v3.0/reference/batch/" class="nav-list-link">batch</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/containers/" class="nav-list-link">containers</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/ec2_on_demand_instances/" class="nav-list-link">ec2_on_demand_instances</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/ec2_spot_instances/" class="nav-list-link">ec2_spot_instances</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/elastic_file_systems/" class="nav-list-link">elastic_file_systems</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/elasticsearch_clusters/" class="nav-list-link">elasticsearch_clusters</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/https_redirects/" class="nav-list-link">https_redirects</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/images/" class="nav-list-link">images</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/lustre_file_systems/" class="nav-list-link">lustre_file_systems</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/mysql_clusters/" class="nav-list-link">mysql_clusters</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/overrides/" class="nav-list-link">overrides</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/postgresql_clusters/" class="nav-list-link">postgresql_clusters</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/provose_config/" class="nav-list-link">provose_config</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/redis_clusters/" class="nav-list-link">redis_clusters</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/s3_buckets/" class="nav-list-link">s3_buckets</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/secrets/" class="nav-list-link">secrets</a> </li><li class="nav-list-item "> <a href="/v3.0/reference/source/" class="nav-list-link">source</a> </li></ul></li><li class="nav-list-item "><a href="/v3.0/debugging/" class="nav-list-link">Debugging</a></li><li class="nav-list-item "><a href="/v3.0/uninstalling/" class="nav-list-link">Uninstalling Provose</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/v2.0/" class="nav-list-link">Docs v2.0 (Deprecated)</a><ul class="nav-list "><li class="nav-list-item "><a href="/v2.0/release-notes/" class="nav-list-link">Release notes</a></li><li class="nav-list-item "><a href="/v2.0/tutorial/" class="nav-list-link">Tutorial</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/v2.0/reference/" class="nav-list-link">Reference v2.0 (Deprecated)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/v2.0/reference/batch/" class="nav-list-link">batch</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/containers/" class="nav-list-link">containers</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/ec2_on_demand_instances/" class="nav-list-link">ec2_on_demand_instances</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/ec2_spot_instances/" class="nav-list-link">ec2_spot_instances</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/elastic_file_systems/" class="nav-list-link">elastic_file_systems</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/elasticsearch_clusters/" class="nav-list-link">elasticsearch_clusters</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/https_redirects/" class="nav-list-link">https_redirects</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/images/" class="nav-list-link">images</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/lustre_file_systems/" class="nav-list-link">lustre_file_systems</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/mysql_clusters/" class="nav-list-link">mysql_clusters</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/overrides/" class="nav-list-link">overrides</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/postgresql_clusters/" class="nav-list-link">postgresql_clusters</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/provose_config/" class="nav-list-link">provose_config</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/redis_clusters/" class="nav-list-link">redis_clusters</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/s3_buckets/" class="nav-list-link">s3_buckets</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/secrets/" class="nav-list-link">secrets</a> </li><li class="nav-list-item "> <a href="/v2.0/reference/source/" class="nav-list-link">source</a> </li></ul></li><li class="nav-list-item "><a href="/v2.0/debugging/" class="nav-list-link">Debugging</a></li><li class="nav-list-item "><a href="/v2.0/uninstalling/" class="nav-list-link">Uninstalling Provose</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/v1.1/" class="nav-list-link">Docs v1.1 (Deprecated)</a><ul class="nav-list "><li class="nav-list-item "><a href="/v1.1/release-notes/" class="nav-list-link">Release notes</a></li><li class="nav-list-item "><a href="/v1.1/tutorial/" class="nav-list-link">Tutorial</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/v1.1/reference/" class="nav-list-link">Reference v1.1 (Deprecated)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/v1.1/reference/containers/" class="nav-list-link">containers</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/ec2_instances/" class="nav-list-link">ec2_instances</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/elasticsearch_clusters/" class="nav-list-link">elasticsearch_clusters</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/images/" class="nav-list-link">images</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/mysql_clusters/" class="nav-list-link">mysql_clusters</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/overrides/" class="nav-list-link">overrides</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/postgresql_clusters/" class="nav-list-link">postgresql_clusters</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/provose_config/" class="nav-list-link">provose_config</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/redis_clusters/" class="nav-list-link">redis_clusters</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/s3_buckets/" class="nav-list-link">s3_buckets</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/secrets/" class="nav-list-link">secrets</a> </li><li class="nav-list-item "> <a href="/v1.1/reference/source/" class="nav-list-link">source</a> </li></ul></li><li class="nav-list-item "><a href="/v1.1/debugging/" class="nav-list-link">Debugging</a></li><li class="nav-list-item "><a href="/v1.1/uninstalling/" class="nav-list-link">Uninstalling Provose</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/v1.0/" class="nav-list-link">Docs v1.0 (Deprecated)</a><ul class="nav-list "><li class="nav-list-item "><a href="/v1.0/release-notes/" class="nav-list-link">Release notes</a></li><li class="nav-list-item "><a href="/v1.0/tutorial/" class="nav-list-link">Tutorial</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/v1.0/reference/" class="nav-list-link">Reference v1.0 (Deprecated)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/v1.0/reference/containers/" class="nav-list-link">containers</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/ec2_instances/" class="nav-list-link">ec2_instances</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/elasticsearch_clusters/" class="nav-list-link">elasticsearch_clusters</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/images/" class="nav-list-link">images</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/mysql_clusters/" class="nav-list-link">mysql_clusters</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/overrides/" class="nav-list-link">overrides</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/postgresql_clusters/" class="nav-list-link">postgresql_clusters</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/provose_config/" class="nav-list-link">provose_config</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/redis_clusters/" class="nav-list-link">redis_clusters</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/s3_buckets/" class="nav-list-link">s3_buckets</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/secrets/" class="nav-list-link">secrets</a> </li><li class="nav-list-item "> <a href="/v1.0/reference/source/" class="nav-list-link">source</a> </li></ul></li><li class="nav-list-item "><a href="/v1.0/debugging/" class="nav-list-link">Debugging</a></li><li class="nav-list-item "><a href="/v1.0/uninstalling/" class="nav-list-link">Uninstalling Provose</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Provose" aria-label="Search Provose" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/provose/provose/" class="site-button" > Provose on GitHub </a> </li> <li class="aux-nav-list-item"> <a href="https://www.neocrym.com" class="site-button" > Neocrym.com </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/v3.0/">Docs v3.0 (Stable)</a></li> <li class="breadcrumb-nav-list-item"><span>Tutorial</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <!-- prettier-ignore-start --> <h1 class="no_toc" id="provose-v30-tutorial"> <a href="#provose-v30-tutorial" class="anchor-heading" aria-labelledby="provose-v30-tutorial"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Provose v3.0 Tutorial </h1> <!-- prettier-ignore-end --> <p>This is a tutorial aimed at teaching the beginner how to use Provose. It helps to be familiar with Amazon Web Services and HashiCorp Terraform, but this tutorial tries to give you the knowledge you need as you go.</p> <p>If you have ideas on improving this tutorial, please <a href="https://github.com/provose/provose/issues">file an issue</a> on Provose’s GitHub page.</p> <!-- prettier-ignore-start --> <h2 class="no_toc" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <!-- prettier-ignore-end --> <!-- prettier-ignore-start --> <ol id="markdown-toc"> <li><a href="#buy-or-move-a-domain-name-in-your-aws-account" id="markdown-toc-buy-or-move-a-domain-name-in-your-aws-account">Buy or move a domain name in your AWS account</a></li> <li><a href="#install-provoses-prerequisites" id="markdown-toc-install-provoses-prerequisites">Install Provose’s prerequisites</a> <ol> <li><a href="#hashicorp-terraform" id="markdown-toc-hashicorp-terraform">HashiCorp Terraform</a></li> <li><a href="#aws-cli-v2" id="markdown-toc-aws-cli-v2">AWS CLI v2</a></li> <li><a href="#docker-optional" id="markdown-toc-docker-optional">Docker (optional)</a></li> </ol> </li> <li><a href="#set-up-your-credentials" id="markdown-toc-set-up-your-credentials">Set up your credentials</a></li> <li><a href="#set-up-an-s3-bucket-to-store-terraform-state" id="markdown-toc-set-up-an-s3-bucket-to-store-terraform-state">Set up an S3 bucket to store Terraform state</a></li> <li><a href="#begin-using-terraform-remote-state" id="markdown-toc-begin-using-terraform-remote-state">Begin using Terraform remote state</a></li> <li><a href="#initialize-provose" id="markdown-toc-initialize-provose">Initialize Provose</a></li> <li><a href="#start-using-provose-modules" id="markdown-toc-start-using-provose-modules">Start using Provose modules</a></li> </ol> <!-- prettier-ignore-end --> <h2 id="buy-or-move-a-domain-name-in-your-aws-account"> <a href="#buy-or-move-a-domain-name-in-your-aws-account" class="anchor-heading" aria-labelledby="buy-or-move-a-domain-name-in-your-aws-account"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Buy or move a domain name in your AWS account </h2> <p>Provose requires that you have a top-level domain name in your AWS account that will be delegated to serving internal services.</p> <p>This domain name is used as the root DNS name for service discovery internal to the VPC–<strong>not</strong> exposed to the public Internet. Provose needs this to be a real, registered public domain name attached to your AWS account so Provose can register AWS Certificate Manager (ACM) TLS certificates. These certificates are used to encrypt and authenticate traffic within the VPC.</p> <p>If your company’s main website is served on <code class="language-plaintext highlighter-rouge">example.com</code>, you should purchase another domain, such as <code class="language-plaintext highlighter-rouge">example-internal.com</code> for Provose. This domain name may host a few publicly-accessible instances, such as SSH “bastion” hosts or VPN endpoints, but mostly will only be used to route network requests within Virtual Private Clouds (VPCs) that Provose creates.</p> <p>Amazon has a guide for <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-register.html">registering a new domain</a> and another one for <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-transfer-to-route-53.html">transferring a domain registered elsewhere into your AWS account</a>.</p> <h2 id="install-provoses-prerequisites"> <a href="#install-provoses-prerequisites" class="anchor-heading" aria-labelledby="install-provoses-prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Install Provose’s prerequisites </h2> <p>Whether you are running Provose on your local machine, an EC2 instance, or a Continuous Integration (CI) provider, you will need to make sure that the machine has the following dependencies installed:</p> <h3 id="hashicorp-terraform"> <a href="#hashicorp-terraform" class="anchor-heading" aria-labelledby="hashicorp-terraform"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> HashiCorp Terraform </h3> <p>Provose is built on top of HashiCorp Terraform, and industry-leading infrastructure-as-code tool.</p> <p>Terraform’s documentation describes how to <a href="https://learn.hashicorp.com/terraform/getting-started/install.html">download and install</a> the latest version of Terraform for your operating system. You will need <strong>Terraform 0.13</strong> or newer to use Provose.</p> <h3 id="aws-cli-v2"> <a href="#aws-cli-v2" class="anchor-heading" aria-labelledby="aws-cli-v2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> AWS CLI v2 </h3> <p>There are some configurations on AWS that Terraform’s AWS provider does not currently support. Provose works around these limitations by setting some configurations with the AWS CLI. If you have v1 of the AWS CLI, make sure to uninstall it first. Then you can follow Amazon’s instructions for installing AWS CLI v2 on <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-mac.html">Mac</a>, <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html">Windows</a>, or <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html">Linux</a>.</p> <h3 id="docker-optional"> <a href="#docker-optional" class="anchor-heading" aria-labelledby="docker-optional"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Docker (optional) </h3> <p>The <code class="language-plaintext highlighter-rouge">docker</code> command is currently only required if you want to build and upload Docker images with the Provose <a href="../reference/images/"><code class="language-plaintext highlighter-rouge">images</code> module</a>. The Docker documentation describes <a href="https://docs.docker.com/get-docker/">how to install the <code class="language-plaintext highlighter-rouge">docker</code> command</a>.</p> <h2 id="set-up-your-credentials"> <a href="#set-up-your-credentials" class="anchor-heading" aria-labelledby="set-up-your-credentials"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Set up your credentials </h2> <p>Provose strongly discourages placing credentials in code.</p> <p>If you want to run Provose (and its underlying Terraform setup) on your local machine, we recommend placing your credentials in the <code class="language-plaintext highlighter-rouge">~/.aws/credentials</code> file in your home directory, with additional configuration in the <code class="language-plaintext highlighter-rouge">~/.aws/config</code> directory. The AWS documentation has more information on <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html">setting up configuration and credential files</a>.</p> <p>An example <code class="language-plaintext highlighter-rouge">~/.aws/credentials</code> file might look like:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[my_profile_name]
aws_access_key_id = ...
aws_secret_access_key = ...
</code></pre></div></div> <p>and an example ‘~/.aws/config` file might look like:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[my-profile-name]
region = us-east-1
</code></pre></div></div> <p>If you have multiple sets of credentials in these files, you can tell Provose which credentials you want to use with the <code class="language-plaintext highlighter-rouge">AWS_PROFILE</code> environment variable.</p> <p>You can also set credentials directly with the environment variables <code class="language-plaintext highlighter-rouge">AWS_ACCESS_KEY_ID</code> and <code class="language-plaintext highlighter-rouge">AWS_SECRET_ACCESS_KEY</code>.</p> <p>If you are running Provose on an AWS EC2 instance, Provose can use the credentials in the IAM instance profile for the instance. AWS has a documentation page about <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html">how to use instance profiles</a>.</p> <h2 id="set-up-an-s3-bucket-to-store-terraform-state"> <a href="#set-up-an-s3-bucket-to-store-terraform-state" class="anchor-heading" aria-labelledby="set-up-an-s3-bucket-to-store-terraform-state"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Set up an S3 bucket to store Terraform state </h2> <p>By default, Terraform stores state about your resources in a local file called <code class="language-plaintext highlighter-rouge">terraform.tfstate</code>. Terraform is also capable of storing this state in <a href="https://www.terraform.io/docs/state/remote.html">various remote backends</a> like an Amazon S3 bucket. Terraform’s <a href="https://www.hashicorp.com/products/terraform/">enterprise version</a> also offers remote state storage, but that is beyond the scope of this tutorial. All features of Provose are available through the free and open-source version of Terraform.</p> <p>If you do not already have a project with pre-configured Terraform state, we recommend you follow these steps to:</p> <ol> <li>Use Terraform to create the S3 bucket that we will use to store Terraform state.</li> <li>Terraform stores the local state from #1 in a local <code class="language-plaintext highlighter-rouge">terraform.tfstate</code> file.</li> <li>We tell Terraform to move the contents of the local state file from #2 into the S3 bucket we created in #1.</li> </ol> <p>If the domain name you have chosen was <code class="language-plaintext highlighter-rouge">example-internal.com</code> and you want to deploy to the AWS region <code class="language-plaintext highlighter-rouge">us-east-1</code>, then the first version of our Terraform state configuration looks like this:</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="c1"># Look out. We're going to replace this `backend "local"` block with</span>
  <span class="c1"># a `backend "s3"` block later in the tutorial.</span>
  <span class="nx">backend</span> <span class="s2">"local"</span> <span class="p">{</span>
    <span class="nx">path</span> <span class="p">=</span> <span class="s2">"terraform.tfstate"</span>
  <span class="p">}</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="c1"># Provose v3.0 currently uses the Terraform AWS provider 3.9.0.</span>
    <span class="c1"># Stick with this version for your own code to avoid compatibility</span>
    <span class="c1"># issues.</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="s2">"3.9.0"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"us-east-1"</span>
<span class="p">}</span>

<span class="c1"># This is an AWS Key Management Service (KMS) key that we will use to</span>
<span class="c1"># encrypt the AWS S3 bucket.</span>
<span class="k">resource</span> <span class="s2">"aws_kms_key"</span> <span class="s2">"terraform"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Used to encrypt the Terraform state S3 bucket at rest."</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Provose</span> <span class="p">=</span> <span class="s2">"terraform"</span>
  <span class="p">}</span>
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">prevent_destroy</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># This is where we store the Terraform remote tfstate.</span>
<span class="k">resource</span> <span class="s2">"aws_s3_bucket"</span> <span class="s2">"terraform"</span> <span class="p">{</span>
  <span class="c1"># This should be a globally-unique Amazon S3 bucket, although it</span>
  <span class="c1"># should not be accessible outside of the AWS credentials you use to run</span>
  <span class="c1"># Terraform.</span>
  <span class="nx">bucket</span> <span class="p">=</span> <span class="s2">"terraform-state.example-internal.com"</span>
  <span class="nx">acl</span>    <span class="p">=</span> <span class="s2">"private"</span>

  <span class="c1"># For security and compliance reasons, Provose recommends that you</span>
  <span class="c1"># configure AWS Key Management Service (KMS) encryption at rest for</span>
  <span class="c1"># the bucket.</span>
  <span class="nx">server_side_encryption_configuration</span> <span class="p">{</span>
    <span class="nx">rule</span> <span class="p">{</span>
      <span class="nx">apply_server_side_encryption_by_default</span> <span class="p">{</span>
        <span class="nx">kms_master_key_id</span> <span class="p">=</span> <span class="nx">aws_kms_key</span><span class="p">.</span><span class="k">terraform</span><span class="p">.</span><span class="nx">arn</span>
        <span class="nx">sse_algorithm</span>     <span class="p">=</span> <span class="s2">"aws:kms"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">versioning</span> <span class="p">{</span>
    <span class="nx">enabled</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Provose</span> <span class="p">=</span> <span class="s2">"terraform"</span>
  <span class="p">}</span>
  <span class="c1"># This lifecycle parameter prevents Terraform from destroying the</span>
  <span class="c1"># bucket that contains its own state.</span>
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">prevent_destroy</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># This prevents public access to our remote Terraform tfstate.</span>
<span class="k">resource</span> <span class="s2">"aws_s3_bucket_public_access_block"</span> <span class="s2">"terraform"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="p">=</span> <span class="nx">aws_s3_bucket</span><span class="p">.</span><span class="k">terraform</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">block_public_acls</span>       <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">block_public_policy</span>     <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">ignore_public_acls</span>      <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">restrict_public_buckets</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">prevent_destroy</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>We recommend that you place the above configuration in a file named <code class="language-plaintext highlighter-rouge">terraform.tf</code>. To keep things organized, you may want to put your Provose configuration into a separate file.</p> <p>This configuration creates the S3 bucket that you will use for remote state, but Terraform must store state in the local file <code class="language-plaintext highlighter-rouge">terraform.tfstate</code> before the S3 bucket is created.</p> <p>After saving <code class="language-plaintext highlighter-rouge">terraform.tf</code>, run the following commands:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform init
terraform plan -out plan.out
terrafrom apply "plan.out"
</code></pre></div></div> <h2 id="begin-using-terraform-remote-state"> <a href="#begin-using-terraform-remote-state" class="anchor-heading" aria-labelledby="begin-using-terraform-remote-state"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Begin using Terraform remote state </h2> <p>In the previous step, we created the S3 bucket to store remote state, but we have not started using the bucket yet–Terraform is still configured to use local state.</p> <p>To move our state to a remote S3 bucket, we need to change the <code class="language-plaintext highlighter-rouge">terraform</code> block at the beginning of our <code class="language-plaintext highlighter-rouge">terraform.tf</code> file to reference remote state:</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="c1"># This is the name of the S3 bucket we use to store Terraform state.</span>
    <span class="c1"># We create this bucket below.</span>
    <span class="nx">bucket</span> <span class="p">=</span> <span class="s2">"terraform-state.example-internal.com"</span>
    <span class="nx">key</span>    <span class="p">=</span> <span class="s2">"tfstate"</span>
    <span class="nx">region</span> <span class="p">=</span> <span class="s2">"us-east-1"</span>
    <span class="nx">acl</span>    <span class="p">=</span> <span class="s2">"private"</span>
  <span class="p">}</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="c1"># Provose v3.0 currently uses the Terraform AWS provider 3.9.0.</span>
    <span class="c1"># Stick with this version for your own code to avoid compatibility</span>
    <span class="c1"># issues.</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="s2">"3.9.0"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
<span class="c1"># ... this file continues from the previous example</span>
</code></pre></div></div> <p>Rerun <code class="language-plaintext highlighter-rouge">terraform init</code> and you should see the following prompt asking if you want to copy your local state to the S3 bucket. Answer with <code class="language-plaintext highlighter-rouge">yes</code>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Initializing the backend...
Do you want to copy existing state to the new backend?
  Pre-existing state was found while migrating the previous "local" backend to the
  newly configured "s3" backend. No existing state was found in the newly
  configured "s3" backend. Do you want to copy this state to the new "s3"
  backend? Enter "yes" to copy and "no" to start with an empty state.

  Enter a value: yes
</code></pre></div></div> <h2 id="initialize-provose"> <a href="#initialize-provose" class="anchor-heading" aria-labelledby="initialize-provose"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Initialize Provose </h2> <p>Now that you have Terraform’s remote state configuration set up, create another file named after the project you want to create with Provose. In these examples, we will go with the name <code class="language-plaintext highlighter-rouge">myproject</code>.</p> <p>In <code class="language-plaintext highlighter-rouge">myproject.tf</code>, we will enter the bare minimum Provose configuration:</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="s2">"myproject"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"github.com/provose/provose?ref=v3.0.0"</span>
  <span class="nx">provose_config</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">authentication</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">region</span> <span class="p">=</span> <span class="s2">"us-east-1"</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">name</span>                 <span class="p">=</span> <span class="s2">"myproject"</span>
    <span class="nx">internal_root_domain</span> <span class="p">=</span> <span class="s2">"example-internal.com"</span>
    <span class="nx">internal_subdomain</span>   <span class="p">=</span> <span class="s2">"myproject"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Run <code class="language-plaintext highlighter-rouge">terraform init</code> again to download Provose v3.0.0 and the Terraform modules and providers that Provose depends on.</p> <p>You should rerun <code class="language-plaintext highlighter-rouge">terraform init</code> every time you update Provose, or if you change any Terraform modules or providers that you use elsewhere in your code.</p> <h2 id="start-using-provose-modules"> <a href="#start-using-provose-modules" class="anchor-heading" aria-labelledby="start-using-provose-modules"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Start using Provose modules </h2> <p>You can now use Provose modules–like <a href="../reference/containers/"><code class="language-plaintext highlighter-rouge">containers</code></a>, <a href="../reference/s3_buckets/"><code class="language-plaintext highlighter-rouge">s3_buckets</code></a>, <a href="../mysql_clusters/"><code class="language-plaintext highlighter-rouge">mysql_clusters</code></a>, and more–to configure the AWS infrastructure that you need.</p> <p>Below is an example of two</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This is the Terraform `random_password` resource that we use to generate secure random</span>
<span class="c1"># passwords for the AWS Aurora MySQL clusters that we provision below.</span>
<span class="c1"># You can read more about the provider here</span>
<span class="c1"># https://www.terraform.io/docs/providers/random/r/password.html</span>
<span class="k">resource</span> <span class="s2">"random_password"</span> <span class="s2">"bigcluster_password"</span> <span class="p">{</span>
  <span class="c1"># AWS RDS passwords must be between 8 and 41 characters</span>
  <span class="nx">length</span> <span class="p">=</span> <span class="mi">41</span>
  <span class="c1"># This is a list of special characters that can be included in the</span>
  <span class="c1"># password. This lits omits characters that often need to be</span>
  <span class="c1"># escaped.</span>
  <span class="nx">override_special</span> <span class="p">=</span> <span class="s2">"()-_=+[]{}&lt;&gt;?"</span>
<span class="p">}</span>

<span class="c1"># This is another  `random_password` resource that we use for the other cluster.</span>
<span class="k">resource</span> <span class="s2">"random_password"</span> <span class="s2">"smallcluster_password"</span> <span class="p">{</span>
  <span class="nx">length</span>           <span class="p">=</span> <span class="mi">41</span>
  <span class="nx">override_special</span> <span class="p">=</span> <span class="s2">"()-_=+[]{}&lt;&gt;?"</span>
<span class="p">}</span>


<span class="k">module</span> <span class="s2">"myproject"</span> <span class="p">{</span>
  <span class="c1"># These are various settings that are core to Provose.</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"github.com/provose/provose?ref=v3.0.0"</span>
  <span class="nx">provose_config</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">authentication</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
        <span class="c1"># Provose is going to pull AWS credentials from you environment.</span>
        <span class="c1"># If you want to specify your keys in code, you can set the</span>
        <span class="c1"># `access_key` and `secret_key` map keys here.</span>
        <span class="nx">region</span> <span class="p">=</span> <span class="s2">"us-east-1"</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">name</span>                 <span class="p">=</span> <span class="s2">"myproject"</span>
    <span class="nx">internal_root_domain</span> <span class="p">=</span> <span class="s2">"example-internal.com"</span>
    <span class="nx">internal_subdomain</span>   <span class="p">=</span> <span class="s2">"myproject"</span>
  <span class="p">}</span>


  <span class="c1"># These are two S3 buckets, which will be made available to one of the</span>
  <span class="c1"># below containers.</span>
  <span class="nx">s3_buckets</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"bucket-one.example-internal.com"</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">versioning</span> <span class="p">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="s2">"another-bucket.example-internal.com"</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">versioning</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>


  <span class="c1"># These are Docker images that we upload to Elastic Container Registry (ECR).</span>
  <span class="nx">images</span> <span class="p">=</span> <span class="p">{</span>
    <span class="c1"># We build this container from a local path and upload it to the registry.</span>
    <span class="s2">"example/webserver"</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">local_path</span> <span class="p">=</span> <span class="s2">"../src/webserver"</span>
    <span class="p">}</span>
    <span class="c1"># We create the ECR image repository for this container, but you need to</span>
    <span class="c1"># build and upload the image yourself.</span>
    <span class="s2">"example/anotherimage"</span> <span class="p">=</span> <span class="p">{}</span>
  <span class="p">}</span>


  <span class="c1"># These are Aurora MySQL clusters.</span>
  <span class="nx">mysql_clusters</span> <span class="p">=</span> <span class="p">{</span>
    <span class="c1"># This creates an AWS Aurora MySQL cluster available</span>
    <span class="c1"># at the host bigcluster.myproject.example-internal.com.</span>
    <span class="c1"># This host is only available within the VPC.</span>
    <span class="nx">bigcluster</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">engine_version</span> <span class="p">=</span> <span class="s2">"5.7.mysql_aurora.2.08.0"</span>
      <span class="nx">database_name</span>  <span class="p">=</span> <span class="s2">"exampledb"</span>
      <span class="nx">password</span>       <span class="p">=</span> <span class="nx">random_password</span><span class="p">.</span><span class="nx">bigcluster_password</span><span class="p">.</span><span class="nx">result</span>
      <span class="nx">instances</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">instance_type</span>  <span class="p">=</span> <span class="s2">"db.r5.large"</span>
        <span class="nx">instance_count</span> <span class="p">=</span> <span class="mi">1</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1"># This creates a cluster at bigmy.production.example-internal.com.</span>
    <span class="c1"># This host is only available within the VPC.</span>
    <span class="nx">smallcluster</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">engine_version</span> <span class="p">=</span> <span class="s2">"5.7.mysql_aurora.2.08.0"</span>
      <span class="nx">database_name</span>  <span class="p">=</span> <span class="s2">"otherdb"</span>
      <span class="nx">password</span>       <span class="p">=</span> <span class="nx">random_password</span><span class="p">.</span><span class="nx">smallcluster_password</span><span class="p">.</span><span class="nx">result</span>
      <span class="nx">instances</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">instance_type</span>  <span class="p">=</span> <span class="s2">"db.t3.small"</span>
        <span class="nx">instance_count</span> <span class="p">=</span> <span class="mi">3</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>


  <span class="c1"># These are names and values for secrets stored in AWS Secrets Manager.</span>
  <span class="nx">secrets</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">bigcluster_password</span>   <span class="p">=</span> <span class="nx">random_password</span><span class="p">.</span><span class="nx">bigcluster_password</span><span class="p">.</span><span class="nx">result</span>
    <span class="nx">smallcluster_password</span> <span class="p">=</span> <span class="nx">random_password</span><span class="p">.</span><span class="nx">smallcluster_password</span><span class="p">.</span><span class="nx">result</span>
  <span class="p">}</span>


  <span class="c1"># These are Docker containers that we run on AWS Elastic Container Service (ECS).</span>
  <span class="c1"># When `private_registry` is `true`, we access one of the images from the</span>
  <span class="c1"># ECR repositories defined above in the `images` section.</span>
  <span class="c1"># When `private_registry` is `false`, we look for publicly-available containers</span>
  <span class="c1"># on Docker Hub.</span>
  <span class="nx">containers</span> <span class="p">=</span> <span class="p">{</span>
    <span class="c1"># This is an example of a container that runs an image that we privately</span>
    <span class="c1"># built and uploaded to ECR.</span>
    <span class="c1"># We run the container on AWS Fargate--which means that there are no EC2</span>
    <span class="c1"># hosts exposed directly to the user.</span>
    <span class="c1"># The container is given access to one of the above MySQL</span>
    <span class="c1"># clusters via environment variables and the Secrets Manager.</span>
    <span class="nx">web</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">image</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">name</span>             <span class="p">=</span> <span class="s2">"example/webserver"</span>
        <span class="nx">tag</span>              <span class="p">=</span> <span class="s2">"latest"</span>
        <span class="nx">private_registry</span> <span class="p">=</span> <span class="kc">true</span>
      <span class="p">}</span>
      <span class="nx">public</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">https</span> <span class="p">=</span> <span class="p">{</span>
          <span class="nx">internal_http_port</span>              <span class="p">=</span> <span class="mi">8000</span>
          <span class="nx">internal_http_health_check_path</span> <span class="p">=</span> <span class="s2">"/"</span>
          <span class="nx">public_dns_names</span>                <span class="p">=</span> <span class="p">[</span><span class="s2">"web.test.example.com"</span><span class="p">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">instances</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">instance_type</span>   <span class="p">=</span> <span class="s2">"FARGATE"</span>
        <span class="nx">container_count</span> <span class="p">=</span> <span class="mi">10</span>
        <span class="nx">cpu</span>             <span class="p">=</span> <span class="mi">256</span>
        <span class="nx">memory</span>          <span class="p">=</span> <span class="mi">512</span>
      <span class="p">}</span>
      <span class="nx">environment</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">MYSQL_HOST</span>     <span class="p">=</span> <span class="s2">"bigcluster.myproject.example-internal.com"</span>
        <span class="nx">MYSQL_USER</span>     <span class="p">=</span> <span class="s2">"root"</span>
        <span class="nx">MYSQL_DATABASE</span> <span class="p">=</span> <span class="s2">"exampledb"</span>
        <span class="nx">MYSQL_PORT</span>     <span class="p">=</span> <span class="mi">3306</span>
      <span class="p">}</span>
      <span class="nx">secrets</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">MYSQL_PASSWORD</span> <span class="p">=</span> <span class="s2">"bigcluster_password"</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1"># This is an example of a container that runs a publicly-available</span>
    <span class="c1"># image from Docker Hub on a few `t2.small` EC2 instances.</span>
    <span class="nx">helloworld</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">image</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">name</span>             <span class="p">=</span> <span class="s2">"nginxdemos/hello"</span>
        <span class="nx">tag</span>              <span class="p">=</span> <span class="s2">"latest"</span>
        <span class="nx">private_registry</span> <span class="p">=</span> <span class="kc">false</span>
      <span class="p">}</span>
      <span class="nx">public</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">https</span> <span class="p">=</span> <span class="p">{</span>
          <span class="nx">internal_http_port</span>              <span class="p">=</span> <span class="mi">80</span>
          <span class="nx">internal_http_health_check_path</span> <span class="p">=</span> <span class="s2">"/"</span>
          <span class="nx">public_dns_names</span>                <span class="p">=</span> <span class="p">[</span><span class="s2">"helloworld.example.com"</span><span class="p">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">instances</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">instance_type</span>   <span class="p">=</span> <span class="s2">"t2.small"</span>
        <span class="nx">container_count</span> <span class="p">=</span> <span class="mi">4</span>
        <span class="nx">instance_count</span>  <span class="p">=</span> <span class="mi">2</span>
        <span class="nx">cpu</span>             <span class="p">=</span> <span class="mi">256</span>
        <span class="nx">memory</span>          <span class="p">=</span> <span class="mi">512</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div> <p>You can read more about Provose’s capabilities in the <a href="../reference/">Reference</a>.</p> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2020-2021 <a href="https://neocrym.com">Neocrym Records Inc</a>. Distributed via an <a href="https://github.com/provose/provose/blob/master/LICENSE">MIT license</a>. <a href="/privacy/">Privacy Policy</a>.</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
